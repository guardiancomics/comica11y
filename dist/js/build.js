"use strict";var comicStrip=document.querySelector(".comic-strip"),comicFrame=document.querySelectorAll(".comic-frame"),highContrastBtn=document.querySelector(".js-highcontrast"),rtlBtn=document.querySelector(".js-rtl"),ccBtn=document.querySelector(".js-closedcaptions"),bubbleBtn=document.querySelector(".js-bubbles");window.a11yTabs=function(t,e){var i=new WeakMap,s=function(t,e){if(!t||!t.nodeType)throw new Error("The DOM element was not found when creating the tab component");this.options=Object.assign({tabList:".tab-list",tabItem:".tab-item",tabLink:".tab-link",tabPanel:".tab-panel"},e),this.element=t,this.tabList=t.querySelector(this.options.tabList),this.tabItems=[].slice.call(this.tabList.querySelectorAll(this.options.tabItem)),this.tabLinks=[].slice.call(this.tabList.querySelectorAll(this.options.tabLink)),this.tabPanels=[].slice.call(t.querySelectorAll(this.options.tabPanel)),this.currentIndex=0,this.tabList.setAttribute("role","tablist"),this.tabItems.forEach(function(t,e){t.setAttribute("role","presentation"),0===e&&t.setAttribute("data-tab-active","")}),this.tabLinks.forEach(function(t,e){t.setAttribute("role","tab"),t.setAttribute("id","tab"+e),e>0?t.setAttribute("tabindex","-1"):t.setAttribute("aria-selected","true")}),this.tabPanels.forEach(function(t,e){t.setAttribute("role","tabpanel"),t.setAttribute("aria-labelledby","tab"+e),t.setAttribute("tabindex","-1"),e>0&&t.setAttribute("hidden","")}),this.eventCallback=r.bind(this),this.tabList.addEventListener("click",this.eventCallback,!1),this.tabList.addEventListener("keydown",this.eventCallback,!1),i.set(this.element,this)};function r(t){if("click"===t.type&&(t.preventDefault(),s.prototype.handleTabInteraction.call(this,this.tabLinks.indexOf(t.target))),"keydown"===t.type){var e=this.tabLinks.indexOf(t.target);37!==t.which&&39!==t.which||(t.preventDefault(),s.prototype.handleTabInteraction.call(this,e,t.which)),40===t.which&&(t.preventDefault(),s.prototype.handleTabpanelFocus.call(this,e))}}return s.prototype={handleTabInteraction:function(t,e){var i=this.currentIndex,s=t;return e&&(s=37===e?t-1:t+1),s<0?s=this.tabLinks.length-1:s===this.tabLinks.length&&(s=0),this.tabLinks[i].setAttribute("tabindex","-1"),this.tabLinks[i].removeAttribute("aria-selected"),this.tabItems[i].removeAttribute("data-tab-active"),this.tabLinks[s].setAttribute("aria-selected","true"),this.tabItems[s].setAttribute("data-tab-active",""),this.tabLinks[s].removeAttribute("tabindex"),this.tabLinks[s].focus(),this.tabPanels[i].setAttribute("hidden",""),this.tabPanels[s].removeAttribute("hidden"),this.currentIndex=s,this},handleTabpanelFocus:function(t){return this.tabPanels[t].focus(),this}},{create:function(t,r){var c=e.querySelector(t);return i.get(c)||new s(c,r)},destroy:function(t){if(!t||!t.nodeType)throw new Error("The DOM element was not found when deleting the tab component");var e=i.get(t);e.tabList.removeAttribute("role","tablist"),e.tabItems.forEach(function(t,e){t.removeAttribute("role","presentation"),0===e&&t.removeAttribute("data-tab-active")}),e.tabLinks.forEach(function(t,e){t.removeAttribute("role","tab"),t.removeAttribute("id","tab"+e),e>0?t.removeAttribute("tabindex","-1"):t.removeAttribute("aria-selected","true")}),e.tabPanels.forEach(function(t,e){t.removeAttribute("role","tabpanel"),t.removeAttribute("aria-labelledby","tab"+e),t.removeAttribute("tabindex","-1"),e>0&&t.removeAttribute("hidden")}),e.tabList.removeEventListener("click",e.eventCallback),e.tabList.removeEventListener("keydown",e.eventCallback),i.delete(e.element)}}}(window,document);var timeout,tabComponent=a11yTabs.create("[data-tab-component]");function colourvisionReset(){(comicStrip.classList.contains("is-cb-protanopia")||comicStrip.classList.contains("is-cb-protanomaly")||comicStrip.classList.contains("is-cb-deuteranopia")||comicStrip.classList.contains("is-cb-deuteranomaly")||comicStrip.classList.contains("is-cb-tritanopia")||comicStrip.classList.contains("is-cb-tritanomaly")||comicStrip.classList.contains("is-cb-achromatopsia")||comicStrip.classList.contains("is-cb-achromatomaly"))&&comicStrip.classList.remove("is-cb-protanopia","is-cb-protanomaly","is-cb-deuteranopia","is-cb-deuteranomaly","is-cb-tritanopia","is-cb-tritanomaly","is-cb-achromatopsia","is-cb-achromatomaly")}function bubbles(){var t=document.querySelector(".comic-frame").offsetWidth-10+"px";document.querySelectorAll(".bubble").forEach(function(e){var i=e.getAttribute("style");i=i+", max-width"+t,e.setAttribute("style",i)}),comicStrip.classList.add("is-loading"),document.querySelectorAll(".bubble svg").forEach(function(t){t.remove()}),document.querySelectorAll(".bubble").forEach(function(t){var e="http://www.w3.org/2000/svg",i=t.clientWidth,s=t.clientHeight,r=t.dataset.direction,c=t.dataset.length;"short"==t.dataset.length?c=50:"normal"==t.dataset.length?c=100:"long"==t.dataset.length&&(c=200);var n=s/2,o=s/8*7,a=s/8,l=i/2,u=i/8,d=i-2,b=n,m=d,h=o,p=l,f=s-2,y=i/8*7,v=f,A=u,S=f,L="M2,"+n+" ";if(L+="C2,"+a,L+=" "+u+",2",L+=" "+l+",2",L+="S"+d+","+a,L+=" "+d+","+b+" ",L+="S"+y+","+v,L+=" "+p+","+f,L+="S2,"+o,L+=" 2,"+n,L+=" z","left"===t.dataset.position)var k=Bezier(g={x:p-2,y:f-2},w={x:A-2,y:S-2},E={x:0,y:o-2},q={x:0,y:n-2},".45"),x=((B=Bezier(g,w,E,q,".2")).x-k.x)/4;else if("right"===t.dataset.position)k=Bezier(g={x:p-2,y:f-2},E={x:y-2,y:v-2},w={x:m-2,y:h-2},q={x:d-2,y:b-2},".2"),x=((B=Bezier(g,E,w,q,".45")).x-k.x)/4;else{var g,w,E,q,B;k=Bezier(g={x:i/2-2*(x=10)-2,y:s-2-2},w={x:A-2-2,y:S-2-2},E={x:-2,y:o-2-2},q={x:i/2+2*x-2,y:s-2-2},"1");x=((B=Bezier(g,w,E,q,"0")).x-k.x)/2}if("left"==r)var z=B.x,C=B.y,j=k.x,I=k.y,T=B.x,P=B.y+c/10,D=B.x-x,F=B.y+c,M=B.x,N=B.y;else z=k.x,C=k.y,j=B.x,I=B.y,T=k.x,P=k.y+c/10,D=k.x+x,F=k.y+c,M=k.x,N=k.y;var O="M"+z+","+(C-1);O+="L"+j+","+(I-1),O+="Q"+T+","+P,O+=" "+D+","+F,O+="L"+M+","+(N-1),O+="z";var R=document.createElementNS(e,"svg"),W=document.createElementNS(e,"path"),H=document.createElementNS(e,"path"),Z=document.createElementNS(e,"path");R.setAttribute("viewBox","0 0 "+i+" "+(s+c)),R.setAttribute("width",i),R.setAttribute("height",s+c),W.setAttribute("d",L),W.setAttribute("stroke","#000"),W.setAttribute("stroke-width",4),W.setAttribute("stroke-linecap","round"),W.setAttribute("stroke-linejoin","round"),W.setAttribute("fill","#fff"),H.setAttribute("d",O),H.setAttribute("stroke","#000"),H.setAttribute("stroke-width",8),H.setAttribute("stroke-linecap","round"),H.setAttribute("stroke-linejoin","round"),H.setAttribute("fill","#000"),Z.setAttribute("d",O),Z.setAttribute("fill","#fff"),R.appendChild(H),R.appendChild(W),R.appendChild(Z),t.appendChild(R)}),comicStrip.classList.remove("is-loading"),bubblesResize()}function bubblesResize(){var t=document.querySelector(".comic-frame").offsetWidth/265+"em";document.querySelectorAll(".bubble").forEach(function(e){e.setAttribute("style","font-size: "+t)})}function browserZoom(){var t=document.querySelector(".bubble"),e=window.getComputedStyle(t);parseInt(e.getPropertyValue("font-size"),10)>23&&(comicStrip.classList.add("is-closed-caption-mode","is-browserZoom"),ccBtn.checked=!0,ccBtn.setAttribute("aria-pressed",!0))}function Bezier(t,e,i,s,r){var c={x:0,y:0},n=1-r,o=n*n,a=o*n;return c.x=t.x*a+3*e.x*o*r+3*i.x*n*r*r+s.x*r*r*r,c.y=t.y*a+3*e.y*o*r+3*i.y*n*r*r+s.y*r*r*r,c}window.addEventListener("resize",function(t){timeout&&window.cancelAnimationFrame(timeout),timeout=window.requestAnimationFrame(function(){bubbles()})},!1),document.querySelectorAll(".caption-sr").forEach(function(t){t.addEventListener("focus",function(t){t.target.parentNode.classList.add("is-active")}),t.addEventListener("blur",function(t){t.target.parentNode.classList.remove("is-active")})}),document.querySelectorAll(".comic-frame").forEach(function(t){t.addEventListener("click",function(e){t.lastElementChild.focus()})}),highContrastBtn.addEventListener("click",function(t){0==!highContrastBtn.checked?(highContrastBtn.checked=!0,highContrastBtn.setAttribute("aria-pressed","true"),comicStrip.classList.add("is-high-contrast-mode"),document.querySelectorAll(".comic-image img").forEach(function(t){var e=t.dataset.contrast;t.setAttribute("src",e)})):(highContrastBtn.checked=!1,highContrastBtn.setAttribute("aria-pressed","false"),comicStrip.classList.remove("is-high-contrast-mode"),document.querySelectorAll(".comic-image img").forEach(function(t){var e=t.dataset.src;t.setAttribute("src",e)}));t.preventDefault}),rtlBtn.addEventListener("click",function(){0==!rtlBtn.checked?(rtlBtn.checked=!0,rtlBtn.setAttribute("aria-pressed","true"),comicStrip.classList.add("is-rtl-mode")):(rtlBtn.checked=!1,rtlBtn.setAttribute("aria-pressed","false"),comicStrip.classList.remove("is-rtl-mode"))}),ccBtn.addEventListener("click",function(){0==!ccBtn.checked?(ccBtn.checked=!0,ccBtn.setAttribute("aria-pressed","true"),comicStrip.classList.add("is-closed-caption-mode"),document.querySelector(".comic-strip").firstElementChild.lastElementChild.focus()):(ccBtn.checked=!1,ccBtn.setAttribute("aria-pressed","false"),comicStrip.classList.remove("is-closed-caption-mode"),document.querySelector(".comic-strip").dataset.fontsize="100",document.querySelector(".font-sizer .label strong").innerHTML="100%",document.querySelectorAll(".comic-strip .caption-closed").forEach(function(t){t.style.fontSize="100%"}),document.querySelector(".js-closedcaptions").focus(),document.querySelector(".js-resize-up").disabled=!1,document.querySelector(".js-resize-down").disabled=!0,comicStrip.removeAttribute("style"))}),document.querySelectorAll(".font-sizer .btn").forEach(function(t){t.addEventListener("click",function(e){var i=document.querySelector(".comic-strip").dataset.fontsize;t.classList.contains("js-resize-up")&&(i=parseFloat(i)+10),t.classList.contains("js-resize-down")&&(i=parseFloat(i)-10),100!=i&&200!=i&&(document.querySelector(".js-resize-down").disabled=!1,document.querySelector(".js-resize-up").disabled=!1),100!=i?(comicStrip.classList.add("is-closed-caption-mode","is-resized"),ccBtn.checked=!0,ccBtn.setAttribute("aria-pressed","true"),document.querySelector(".comic-strip").firstElementChild.lastElementChild.focus()):(comicStrip.classList.contains("is-browserZoom")||(comicStrip.classList.remove("is-closed-caption-mode"),ccBtn.checked=!1,ccBtn.setAttribute("aria-pressed","false")),comicStrip.classList.remove("is-resized")),100==i?(document.querySelector(".js-resize-down").disabled=!0,comicStrip.removeAttribute("style")):comicStrip.setAttribute("style","font-size: "+i+"%"),200==i&&(document.querySelector(".js-resize-up").disabled=!0),comicStrip.dataset.fontsize=i,document.querySelector(".font-sizer .label strong").innerHTML=i+"%",e.preventDefault})}),document.querySelector(".js-colourvision").addEventListener("change",function(t){var e=t.srcElement,i=e.options[e.selectedIndex].value;colourvisionReset(),"normal"!=i?document.querySelector(".comic-strip").classList.add("is-cb-"+i):colourvisionReset()}),bubbles(),bubbleBtn.addEventListener("click",function(t){bubbles(),t.preventDefault});